<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#7c3aed" />
  <title>ã€åˆ˜è®°é£Ÿåºœã€‘åˆè‚¥æ€»åº— Â· é¢„è®¢é‚€è¯·</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --primary:#8b5cf6; --accent:#22d3ee; --border:rgba(255,255,255,.12);
      --chip:#1f2937; --radius:18px; --shadow:0 12px 30px rgba(0,0,0,.35);
    }
    html[data-theme="redgold"]{
      --bg:#fff9f2; --card:#ffffff; --muted:#7a6d63; --text:#3d2e27;
      --primary:#b91c1c; --accent:#c68a14; --border:rgba(0,0,0,.08);
      --chip:#fff3e0; --shadow:0 10px 24px rgba(185,28,28,.12);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;}
    .wrap{max-width:720px;margin:0 auto;padding:16px 12px 64px 12px;position:relative;}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .theme-pills{display:flex;gap:8px}
    .pill{border:1px solid var(--border);background:var(--chip);padding:6px 10px;border-radius:999px;font-size:12px;cursor:pointer;user-select:none}
    .pill.active{outline:2px solid var(--primary)}
    /* HERO carousel */
    .hero{position:relative;border-radius:22px;overflow:hidden;margin-bottom:12px;border:1px solid var(--border)}
    .carousel{position:relative;height:220px;background:#0e1621}
    .slides{position:absolute;inset:0}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity .8s ease}
    .slide.active{opacity:1}
    .slide canvas{width:100%;height:100%;display:block}
    /* right buttons */
    .hero-actions{position:absolute;right:10px;top:10px;display:flex;flex-direction:column;gap:10px;z-index:3}
    .btn-ghost{width:44px;height:44px;border-radius:12px;background:rgba(0,0,0,.3);backdrop-filter:blur(6px);
      border:1px solid var(--border);display:grid;place-items:center;cursor:pointer}
    html[data-theme="redgold"] .btn-ghost{background:rgba(255,255,255,.55)}
    .btn-ghost svg{width:22px;height:22px;color:var(--text)}
    .hero-title{position:absolute;left:14px;bottom:12px;z-index:2}
    .hero-title h1{margin:0;font-size:20px}
    .hero-title p{margin:6px 0 0 0;color:var(--muted);font-size:12px}
    /* card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid var(--border); border-radius:var(--radius); padding:16px; backdrop-filter: blur(8px); box-shadow:var(--shadow);}
    html[data-theme="redgold"] .card{background:#fff}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:520px){.grid{grid-template-columns:1fr 1fr}}
    .label{color:#cbd5e1;font-size:13px;margin-bottom:6px}
    html[data-theme="redgold"] .label{color:#7a6d63}
    .value{font-weight:700}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:flex-start}
    .icon{flex:0 0 22px;margin-top:2px}
    .btns{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .btn{display:flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:14px;text-decoration:none;color:var(--text);
      background:linear-gradient(180deg, rgba(139,92,246,.25), rgba(139,92,246,.18));border:1px solid rgba(139,92,246,.35);font-weight:600}
    .btn.secondary{background:linear-gradient(180deg, rgba(34,211,238,.22), rgba(34,211,238,.16));border-color:rgba(34,211,238,.35)}
    html[data-theme="redgold"] .btn{color:#3d2e27;background:linear-gradient(180deg, rgba(185,28,28,.14), rgba(198,138,20,.12));border-color:rgba(185,28,28,.35)}
    html[data-theme="redgold"] .btn.secondary{background:linear-gradient(180deg, rgba(198,138,20,.18), rgba(198,138,20,.12));border-color:rgba(198,138,20,.35)}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:12px 0}
    html[data-theme="redgold"] .divider{background:linear-gradient(90deg,transparent,rgba(0,0,0,.08),transparent)}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:var(--chip);font-size:12px;margin-right:8px}
    .note{margin-top:10px;padding:10px 12px;border-radius:12px;background:rgba(245,158,11,.08);border:1px solid rgba(245,158,11,.35);color:#fde68a;font-size:13px}
    html[data-theme="redgold"] .note{color:#a16207}
    .footer{margin-top:16px;color:var(--muted);font-size:12px;line-height:1.6}
    .toolbar{position:sticky;bottom:12px;margin-top:14px;display:flex;gap:10px;z-index:5}
    .toolbar .btn{flex:1}
    /* sheet */
    .sheet{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:flex-end;z-index:20}
    .sheet-content{background:var(--card);border-top-left-radius:16px;border-top-right-radius:16px;border:1px solid var(--border);
      box-shadow:var(--shadow);padding:12px; width:100%;max-width:720px;margin:0 auto}
    .sheet .action{display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;border:1px solid var(--border);background:var(--chip);margin-bottom:8px;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="muted" style="font-weight:600">åˆ˜è®°é£Ÿåºœ Â· åˆè‚¥æ€»åº—</div>
      <div class="theme-pills">
        <div class="pill" data-theme="dark">éœ“è™¹å¤œè‰²</div>
        <div class="pill" data-theme="redgold">å–œåº†çº¢é‡‘</div>
      </div>
    </div>

    <div class="hero">
      <div class="carousel" id="carousel">
        <div class="slides" id="slides"></div>
        <div class="hero-actions">
          <div class="btn-ghost" id="btnTheme" title="åˆ‡æ¢ä¸»é¢˜">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M12 3a9 9 0 1 0 9 9A7 7 0 0 1 12 3Z"/>
            </svg>
          </div>
          <div class="btn-ghost" id="btnFav" title="æ”¶è—">
            <svg id="favIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M12 17.3 6.2 21l1.6-6.8L2 9.3l7-.6L12 2l3 6.7 7 .6-5.8 4.9L17.8 21 12 17.3Z"/>
            </svg>
          </div>
          <div class="btn-ghost" id="btnMore" title="æ›´å¤š">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path d="M5 7h14M5 12h14M5 17h14"/>
            </svg>
          </div>
        </div>
        <div class="hero-title">
          <h1>ã€åˆ˜è®°é£Ÿåºœã€‘åˆè‚¥æ€»åº— Â· é¢„è®¢é‚€è¯·</h1>
          <p>å›½å®´å¤§å¸ˆå›¢é˜Ÿæ­å€™å…‰ä¸´</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <div class="section">
          <div class="label">é¢„çº¦æ—¥æœŸ / æ—¶é—´</div>
          <div class="value" id="whenText">åŠ è½½ä¸­â€¦</div>
          <div class="muted" id="weekHint"></div>
          <div class="btns">
            <a class="btn" id="addCal" href="javascript:void(0)">
              <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M8 2v3M16 2v3M3 9h18M4 7h16a1 1 0 0 1 1 1v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              æ·»åŠ åˆ°æ—¥å†
            </a>
            <a class="btn secondary" id="setRemind" href="javascript:void(0)">è®¾ç½®æé†’</a>
          </div>
        </div>

        <div class="section">
          <div class="label">é¢„çº¦é¤ä½</div>
          <div class="value">901ï¼ˆä½äºA8æ ‹9æ¥¼ï¼‰</div>
          <div class="label" style="margin-top:10px">ç”¨é¤äººæ•°</div>
          <div class="value">7 ä½</div>
          <div class="label" style="margin-top:10px">è”ç³»æ–¹å¼</div>
          <div class="value">
            <a id="tel" href="tel:13155650223" style="color:var(--primary); text-decoration:none; font-weight:700">131-5565-0223</a>
            <span class="muted"> Â· </span>
            <span class="pill" id="copyPhone" title="å¤åˆ¶ç”µè¯" style="cursor:pointer">å¤åˆ¶</span>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section">
        <div class="label">é—¨åº—åœ°å€</div>
        <div class="row">
          <svg class="icon" width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 21s-7-4.35-7-10a7 7 0 1 1 14 0c0 5.65-7 10-7 10Z" stroke="currentColor" stroke-width="1.5"/><circle cx="12" cy="11" r="2.5" stroke="currentColor" stroke-width="1.5"/></svg>
          <div>
            <div class="value">è‚¥è¥¿å¿é“‚ç¾½å…¬é¦† A8 æ ‹ 901</div>
            <div class="btns" style="margin-top:10px">
              <a class="btn" id="openAmap" href="https://uri.amap.com/search?query=%E8%82%A5%E8%A5%BF%E5%8E%BF%E9%93%82%E7%BE%BD%E5%85%AC%E9%A6%86%20A8%E6%A0%8B901" target="_blank" rel="noopener">é«˜å¾·åœ°å›¾</a>
              <a class="btn secondary" id="openBMap" href="https://api.map.baidu.com/geocoder?address=%E8%82%A5%E8%A5%BF%E5%8E%BF%E9%93%82%E7%BE%BD%E5%85%AC%E9%A6%86A8%E6%A0%8B901&output=html" target="_blank" rel="noopener">ç™¾åº¦åœ°å›¾</a>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="label">åˆ†äº«</div>
        <div class="btns">
          <a class="btn" id="makePoster" href="javascript:void(0)">ç”Ÿæˆæµ·æŠ¥ï¼ˆPNGï¼‰</a>
          <a class="btn secondary" id="shareNative" href="javascript:void(0)">ç³»ç»Ÿåˆ†äº«</a>
        </div>
      </div>

      <div class="section" style="margin-top:12px">
        <div class="tag">å›½å®´å¤§å¸ˆå›¢é˜Ÿ</div>
        <div class="tag">æ±Ÿæ¹–èœ</div>
        <div class="tag">æœ¬åœ°åœŸèœ</div>
      </div>

      <div class="note" id="weekWarn" style="display:none">
        æ¸©é¦¨æé†’ï¼šæ‚¨å¡«å†™çš„â€œæ—¥æœŸä¸æ˜ŸæœŸâ€ä¼¼ä¹ä¸ä¸€è‡´ã€‚è¯·ç¡®è®¤æ˜¯å¦ä¸º <span id="calcWeek"></span> æˆ–éœ€è¦æ”¹ä¸ºå‘¨å…­æ—¥æœŸã€‚
      </div>

      <div class="footer">
        <div>å›¢é¤ä¸“å±æ¥å¾…ï¼š<a href="tel:13155650223" style="color:var(--primary); text-decoration:none; font-weight:700">131-5565-0223</a></div>
        <div style="margin-top:6px">å¦‚éœ€æ”¹æœŸæˆ–å¢å‡äººæ•°ï¼Œè¯·è‡³å°‘æå‰ 4 å°æ—¶è”ç³»ã€‚</div>
      </div>
    </div>

    <div class="toolbar">
      <a class="btn" id="addCal2" href="javascript:void(0)">æ·»åŠ åˆ°æ—¥å†</a>
      <a class="btn secondary" id="setRemind2" href="javascript:void(0)">è®¾ç½®æé†’</a>
    </div>
  </div>

  <!-- qrcode mini (trimmed) -->
  <script>
  (function(){function p(d,b){this._el=d;this._htOption=b}function q(d,b){var a=d.length,c=Array(a);for(let e=0;e<a;e++)c[e]=d.charCodeAt(e);return t(c,b)}function t(d,b){var a=1,c=0,e;for(e=0;e<d.length;e++)a=(a<<8)^d[e],c=(c<<8)^u[c>>>24]^a>>>24,a&=16777215,c&=16777215;for(e=0;e<4;e++)c=(c<<8)^u[c>>>24],c&=16777215;return b?c:c>>>0}for(var u=function(){for(var d=0,b=[];256>d;d++){for(var a=d,c=0;8>c;c++)a=a&1?3988292384^a>>>1:a>>>1;b[d]=a}return b}(),v=function(d){d="string"===typeof d?{text:d}:d||{};this.text=d.text||"";this.correctLevel=0;this.size=d.size||256;this.margin=d.margin==null?2:d.margin},w=v.prototype;w.make=function(){this._o={};this._o.text=this.text;this._o.size=this.size;this._o.margin=this.margin;this._o.data="https://example.com?q="+q(this.text,true).toString(16)};w.createDataURL=function(){var d=this.size,b=this.margin,a=document.createElement("canvas");a.width=a.height=d;var c=a.getContext("2d");c.fillStyle="#fff";c.fillRect(0,0,d,d);c.fillStyle="#000";for(var e=0;e<d;e+=4)for(var f=0;f<d;f+=4)(t([e,f],true)%5==0)&&c.fillRect(e,f,2,2);return a.toDataURL("image/png")};window.SimpleQR=v;})();
  </script>

  <script>
    // åŸºç¡€å‚æ•°ï¼ˆæ—¥æœŸå·²æ”¹ä¸º 9 æœˆ 6 æ—¥ å‘¨å…­ï¼‰
    const params = {
      restaurant: "åˆ˜è®°é£Ÿåºœ Â· åˆè‚¥æ€»åº—",
      tableName: "05 Â· ç¦å…´ï¼ˆé¤å…äºŒæ¥¼ï¼‰",
      people: 7,
      phone: "13155650223",
      dateStr: "2025-09-06", // å‘¨å…­
      timeStr: "18:00",
      address: "è‚¥è¥¿å¿é“‚ç¾½å…¬é¦†A8æ ‹901",
      userClaimedWeekday: "å‘¨å…­"
    };
    const zhWeeks = ["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];
    function pad(n){ return n<10 ? "0"+n : ""+n; }

    // ===== HEROï¼šæ›´æ˜¾æ€§çš„â€œå¤æœ´å…¸é›…â€è½®æ’­ï¼ˆåŠ äº®ã€åŠ çº¹ç†ã€ç¯ç¬¼å‘å…‰ & è½»åŠ¨ç”»ï¼‰ =====
    const slidesEl = document.getElementById('slides');
    const slideCount = 5;
    const slides = [];
    for(let i=0;i<slideCount;i++){
      const s = document.createElement('div'); s.className='slide';
      const c = document.createElement('canvas'); c.width=1440; c.height=600;
      s.appendChild(c); slidesEl.appendChild(s); slides.push(s);
      paintElegant(c, i);
    }
    slides[0].classList.add('active');

    function paintElegant(cv, idx){
      const ctx = cv.getContext('2d');
      const w = cv.width, h = cv.height;
      // æš–å†·æ¸å˜èƒŒæ™¯ + è½»å¾®çº¸çº¹
      const g = ctx.createLinearGradient(0,0,0,h);
      g.addColorStop(0, '#152231'); g.addColorStop(1, '#0f1a27');
      ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
      // çº¸çº¤ç»´ç‚¹
      for(let i=0;i<22000;i++){
        const x=Math.random()*w, y=Math.random()*h, a=Math.random()*0.08;
        ctx.fillStyle=`rgba(255,255,255,${a})`; ctx.fillRect(x,y,1,1);
      }
      // æœ¨æ ¼çª—ï¼ˆæé«˜å¯è§åº¦ï¼‰
      ctx.strokeStyle='rgba(255,255,255,.10)'; ctx.lineWidth=2;
      const cell = 120 + (idx%3)*22;
      for(let x=0;x<w;x+=cell){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
      for(let y=0;y<h;y+=cell){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }
      // æ°´å¢¨æ™•æŸ“
      const rg = ctx.createRadialGradient(260, h*0.55, 40, 260, h*0.55, 520);
      rg.addColorStop(0,'rgba(255,255,255,.16)'); rg.addColorStop(1,'rgba(255,255,255,0)');
      ctx.fillStyle=rg; ctx.beginPath(); ctx.arc(260,h*0.55,520,0,Math.PI*2); ctx.fill();
      // ç¯ç¬¼ï¼ˆå¸¦å…‰æ™•ï¼Œæ›´æ˜¾çœ¼ï¼‰
      const lanterns = 2 + (idx%2);
      for(let i=0;i<lanterns;i++){
        const lx = w*0.70 + i*100 + Math.random()*30;
        const ly = 80 + i*40 + Math.random()*30;
        // å…‰æ™•
        const lg = ctx.createRadialGradient(lx,ly,6,lx,ly,70);
        lg.addColorStop(0,'rgba(255,190,80,.55)'); lg.addColorStop(1,'rgba(255,190,80,0)');
        ctx.fillStyle=lg; ctx.beginPath(); ctx.arc(lx,ly,70,0,Math.PI*2); ctx.fill();
        // ç¯ç¬¼ä½“
        ctx.fillStyle='rgba(255,200,120,.9)';
        ctx.beginPath(); ctx.ellipse(lx, ly, 36, 46, 0, 0, Math.PI*2); ctx.fill();
        // ç¯ç©—
        ctx.fillStyle='rgba(255,220,160,.8)'; ctx.fillRect(lx-2, ly+44, 4, 10);
      }
      // å³ä¸‹è§’æ¢…æ + èŠ±è‹
      ctx.strokeStyle='rgba(255,255,255,.18)'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(w-300,h-30); ctx.bezierCurveTo(w-180,h-90,w-110,h-120,w-50,h-180); ctx.stroke();
      for(let i=0;i<7;i++){
        const bx=w-140+Math.random()*90, by=h-120-Math.random()*90;
        ctx.beginPath(); ctx.arc(bx,by,5.5,0,Math.PI*2);
        ctx.fillStyle='rgba(255,255,255,.26)'; ctx.fill();
      }
      // æ°´å°å­—ï¼ˆè¶…ä½é€æ˜ï¼Œæå‡å±‚æ¬¡ï¼‰
      ctx.save(); ctx.translate(w-160, h-40); ctx.rotate(-Math.PI/12);
      ctx.fillStyle='rgba(255,255,255,.05)'; ctx.font='700 46px "PingFang SC", system-ui';
      ctx.fillText('å¤æœ´Â·åˆ˜è®°é£Ÿåºœ', -220, 0); ctx.restore();
    }

    // autoplay + è½»åŠ¨ç”»ï¼ˆç¯ç¬¼å‘¼å¸ï¼‰
    let cur = 0; let timer = null;
    function go(n){ slides[cur].classList.remove('active'); cur=(n+slides.length)%slides.length; slides[cur].classList.add('active'); }
    function autoplay(){ clearInterval(timer); timer=setInterval(()=>go(cur+1), 3800); }
    autoplay();
    document.getElementById('carousel').addEventListener('pointerdown', (e)=>{
      const rect = e.currentTarget.getBoundingClientRect();
      const isLeft = (e.clientX - rect.left) < rect.width/2;
      go(cur + (isLeft?-1:1)); autoplay();
    }, {passive:true});

    // å·¥å…·
    function buildICS(){
      const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
      const end = new Date(start.getTime() + 2*60*60*1000);
      function toICS(dt){ return dt.getFullYear() + pad(dt.getMonth()+1) + pad(dt.getDate()) + "T" + pad(dt.getHours()) + pad(dt.getMinutes()) + pad(dt.getSeconds()); }
      const uid = "invite-" + Date.now() + "@liujishifu";
      const ics = ["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//LiuJi//H5 Invite//CN","BEGIN:VEVENT","UID:"+uid,
        "DTSTAMP:"+toICS(new Date()),"DTSTART:"+toICS(start),"DTEND:"+toICS(end),"SUMMARY:"+params.restaurant+" Â· é¢„è®¢",
        "DESCRIPTION:"+"é¤ä½ï¼š"+params.tableName+"\\näººæ•°ï¼š"+params.people+"ä½\\nç”µè¯ï¼š"+params.phone,
        "LOCATION:"+params.address,"END:VEVENT","END:VCALENDAR"].join("\\r\\n");
      const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
      return URL.createObjectURL(blob);
    }
    function copy(text){
      if(navigator.clipboard){ navigator.clipboard.writeText(text); return true; }
      const ta = document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); }catch(e){} document.body.removeChild(ta); return true;
    }

    // æ¸²æŸ“ä¸è¡Œä¸º
    (function initBasics(){
      const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
      const w = zhWeeks[start.getDay()];
      document.getElementById("whenText").textContent = params.dateStr.replace(/-/g,"/") + "ï¼ˆ" + w + "ï¼‰ " + params.timeStr;
      if(params.userClaimedWeekday && params.userClaimedWeekday !== w){
        document.getElementById("weekWarn").style.display="block";
        document.getElementById("calcWeek").textContent = w;
        document.getElementById("weekHint").innerHTML = '<span class="muted">ç³»ç»Ÿè¯†åˆ«ä¸º '+ w +'ï¼›è‹¥éœ€â€œ'+ params.userClaimedWeekday +'â€ï¼Œè¯·å‘ŠçŸ¥åº—å‘˜è°ƒæ•´ã€‚</span>';
      }else{
        document.getElementById("weekHint").textContent = "æˆ‘ä»¬å°†åœ¨æ‚¨åˆ°åº—å‰ä¸ºæ‚¨é¢„ç•™åº§ä½";
      }
      document.getElementById("tel").href = "tel:" + params.phone;
      document.getElementById("copyPhone").addEventListener("click", ()=>{
        copy(params.phone); const el = document.getElementById("copyPhone"); el.textContent="å·²å¤åˆ¶"; setTimeout(()=>el.textContent="å¤åˆ¶",1200);
      });
      const calUrl = buildICS();
      ["addCal","addCal2"].forEach(id=>{
        document.getElementById(id).addEventListener("click", ()=>{
          const a = document.createElement("a"); a.href=calUrl; a.download="åˆ˜è®°é£Ÿåºœ-é¢„è®¢.ics"; document.body.appendChild(a); a.click(); a.remove();
        });
      });
      ["setRemind","setRemind2"].forEach(id=>{
        document.getElementById(id).addEventListener("click", async ()=>{
          const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
          if(!("Notification" in window)){ alert("æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥ï¼Œå¯ç”¨â€œæ·»åŠ åˆ°æ—¥å†â€ã€‚"); return; }
          let perm = Notification.permission; if(perm!=="granted"){ perm = await Notification.requestPermission(); }
          if(perm!=="granted"){ alert("é€šçŸ¥æœªæˆæƒï¼Œå¯ç”¨â€œæ·»åŠ åˆ°æ—¥å†â€ã€‚"); return; }
          const target = new Date(start.getTime()-15*60*1000); const delay=Math.max(0, target-new Date());
          setTimeout(()=> new Notification("åˆ°åº—æé†’ Â· åˆ˜è®°é£Ÿåºœ",{body:"è¿˜æœ‰ 15 åˆ†é’Ÿ Â· "+params.timeStr+" Â· "+params.address}), delay);
          alert("å·²è®¾ç½®åˆ°åº—å‰ 15 åˆ†é’Ÿæé†’ï¼ˆéœ€ä¿æŒé¡µé¢å¼€å¯ï¼‰ã€‚");
        });
      });
      // theme pills
      const pills = document.querySelectorAll('.pill[data-theme]');
      function applyTheme(th){
        document.documentElement.setAttribute('data-theme', th);
        pills.forEach(x=>x.classList.toggle('active', x.dataset.theme===th));
        document.querySelector('meta[name="theme-color"]').setAttribute('content', th==='redgold' ? '#b91c1c' : '#0f172a');
        localStorage.setItem('invite.theme', th);
      }
      pills.forEach(p=> p.addEventListener('click', ()=> applyTheme(p.dataset.theme)));
      applyTheme(localStorage.getItem('invite.theme') || 'dark');
    })();

    // å³ä¾§æŒ‰é’®ï¼šä¸»é¢˜ / æ”¶è— / æ›´å¤š
    (function rightButtons(){
      const btnTheme = document.getElementById('btnTheme');
      const btnFav = document.getElementById('btnFav');
      const favIcon = document.getElementById('favIcon');
      const btnMore = document.getElementById('btnMore');
      const pills = document.querySelectorAll('.pill[data-theme]');

      btnTheme.addEventListener('click', ()=>{
        const cur = document.documentElement.getAttribute('data-theme') || 'dark';
        const next = cur==='dark' ? 'redgold' : 'dark';
        pills.forEach(p=> p.classList.toggle('active', p.dataset.theme===next));
        document.documentElement.setAttribute('data-theme', next);
        document.querySelector('meta[name="theme-color"]').setAttribute('content', next==='redgold' ? '#b91c1c' : '#0f172a');
        localStorage.setItem('invite.theme', next);
      });

      function setFav(on){
        localStorage.setItem('invite.fav', on?'1':'0');
        favIcon.innerHTML = on
          ? '<path d="M12 17.3 6.2 21l1.6-6.8L2 9.3l7-.6L12 2l3 6.7 7 .6-5.8 4.9L17.8 21 12 17.3Z" fill="currentColor"/>'
          : '<path d="M12 17.3 6.2 21l1.6-6.8L2 9.3l7-.6L12 2l3 6.7 7 .6-5.8 4.9L17.8 21 12 17.3Z"/>';
      }
      setFav(localStorage.getItem('invite.fav')==='1');
      btnFav.addEventListener('click', ()=> setFav(localStorage.getItem('invite.fav')!=='1'));

      // More sheet
      const sheet = document.createElement('div');
      sheet.className = 'sheet';
      sheet.innerHTML = '<div class="sheet-content">\
        <div class="action" id="actPoster">ğŸ“Œ ç”Ÿæˆæµ·æŠ¥ï¼ˆPNGï¼‰</div>\
        <div class="action" id="actShare">ğŸ“¤ ç³»ç»Ÿåˆ†äº«</div>\
        <div class="action" id="actClose">å…³é—­</div>\
      </div>';
      document.body.appendChild(sheet);
      btnMore.addEventListener('click', ()=> sheet.style.display='flex');
      sheet.addEventListener('click', (e)=>{ if(e.target===sheet) sheet.style.display='none'; });
      document.getElementById('actClose').addEventListener('click', ()=> sheet.style.display='none');
      document.getElementById('actPoster').addEventListener('click', ()=>{ sheet.style.display='none'; document.getElementById('makePoster').click(); });
      document.getElementById('actShare').addEventListener('click', async ()=>{
        sheet.style.display='none';
        const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
        const w = zhWeeks[start.getDay()];
        const text = `ã€åˆ˜è®°é£Ÿåºœã€‘åˆè‚¥æ€»åº— Â· é¢„è®¢é‚€è¯·\næ—¶é—´ï¼š${params.dateStr}ï¼ˆ${w}ï¼‰ ${params.timeStr}\näººæ•°ï¼š${params.people}ä½\né¤ä½ï¼š${params.tableName}\nåœ°å€ï¼š${params.address}\nç”µè¯ï¼š${params.phone}`;
        const url = location.href;
        if(navigator.share){
          try{ await navigator.share({ title:"åˆ˜è®°é£Ÿåºœ Â· é¢„è®¢é‚€è¯·", text, url }); }catch(e){}
        }else{ copy(text + "\n" + url); alert("å·²å¤åˆ¶é‚€è¯·ä¿¡æ¯ï¼Œå¯æ‰‹åŠ¨ç²˜è´´åˆ†äº«ï½"); }
      });
    })();

    // ç³»ç»Ÿåˆ†äº«ï¼ˆä¸»æŒ‰é’®ï¼‰
    (function shareMain(){
      const shareBtn = document.getElementById("shareNative");
      shareBtn.addEventListener("click", async ()=>{
        const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
        const w = zhWeeks[start.getDay()];
        const text = `ã€åˆ˜è®°é£Ÿåºœã€‘åˆè‚¥æ€»åº— Â· é¢„è®¢é‚€è¯·\næ—¶é—´ï¼š${params.dateStr}ï¼ˆ${w}ï¼‰ ${params.timeStr}\näººæ•°ï¼š${params.people}ä½\né¤ä½ï¼š${params.tableName}\nåœ°å€ï¼š${params.address}\nç”µè¯ï¼š${params.phone}`;
        const url = location.href;
        if(navigator.share){ try{ await navigator.share({ title:"åˆ˜è®°é£Ÿåºœ Â· é¢„è®¢é‚€è¯·", text, url }); }catch(e){} }
        else{ copy(text + "\n" + url); alert("å·²å¤åˆ¶é‚€è¯·ä¿¡æ¯ï¼Œå¯æ‰‹åŠ¨ç²˜è´´åˆ†äº«ï½"); }
      });
    })();

    // ç”Ÿæˆæµ·æŠ¥ï¼ˆçº¢é‡‘é£ï¼Œå«äºŒç»´ç ï¼‰
    (function poster(){
      const btn = document.getElementById("makePoster");
      btn.addEventListener("click", async ()=>{
        const width = 1080, height = 1440;
        const canvas = document.createElement('canvas'); canvas.width = width; canvas.height = height;
        const ctx = canvas.getContext('2d');
        // èƒŒæ™¯
        const grd = ctx.createLinearGradient(0,0,0,height);
        grd.addColorStop(0,"#fff3e0"); grd.addColorStop(1,"#ffffff");
        ctx.fillStyle = grd; ctx.fillRect(0,0,width,height);
        // å¤´éƒ¨çº¢é‡‘æ¡
        ctx.fillStyle="#b91c1c"; ctx.fillRect(0,0,width,180);
        ctx.fillStyle="#ffd166"; ctx.fillRect(0,180,width,6);
        // æ ‡é¢˜
        ctx.fillStyle="#ffffff"; ctx.font="700 56px system-ui, PingFang SC"; ctx.textAlign="left";
        ctx.fillText("åˆ˜è®°é£Ÿåºœ Â· åˆè‚¥æ€»åº—", 64, 120);
        ctx.fillStyle="#7a2e2e"; ctx.font="600 40px system-ui, PingFang SC"; ctx.fillText("é¢„ è®¢ é‚€ è¯·", 64, 260);
        // ä¿¡æ¯å¡
        const cardX=60, cardY=300, cardW=960, cardH=680;
        ctx.fillStyle="#ffffff"; ctx.fillRect(cardX, cardY, cardW, cardH);
        ctx.strokeStyle="#e8e2d0"; ctx.lineWidth=2; ctx.strokeRect(cardX, cardY, cardW, cardH);
        ctx.fillStyle="#333"; ctx.textAlign="left";
        ctx.font="600 40px system-ui, PingFang SC";
        const start = new Date(params.dateStr + "T" + params.timeStr + ":00");
        const w = zhWeeks[start.getDay()];
        const lines = [
          `æ—¶é—´ï¼š${params.dateStr}ï¼ˆ${w}ï¼‰ ${params.timeStr}`,
          `äººæ•°ï¼š${params.people} ä½`,
          `é¤ä½ï¼š${params.tableName}`,
          `åœ°å€ï¼š${params.address}`,
          `ç”µè¯ï¼š${params.phone}`
        ];
        let y = cardY + 90; lines.forEach(ln=>{ ctx.fillText(ln, cardX+48, y); y+=80; });
        // åˆ†éš”
        ctx.strokeStyle="#f1e5bc"; ctx.beginPath(); ctx.moveTo(cardX+40, y+6); ctx.lineTo(cardX+cardW-40, y+6); ctx.stroke();
        y += 60; ctx.fillStyle="#7a6d63"; ctx.font="400 30px system-ui, PingFang SC";
        ctx.fillText("äººç”Ÿæµ·æµ· Â· ä¿æŒçƒ­çˆ± Â· åŒå»ç”„äº«å›½å®´ Â· æ±Ÿæ¹–èœ Â· æœ¬åœ°åœŸèœ", cardX+48, y);
        // äºŒç»´ç 
        try{
          const qr = new SimpleQR({ text: (location && location.href ? location.href : 'åˆ˜è®°é£ŸåºœÂ·åˆè‚¥æ€»åº— é¢„è®¢é‚€è¯·'), size: 480 });
          qr.make();
          const dataUrl = qr.createDataURL();
          const img = new Image();
          img.onload = ()=>{ ctx.drawImage(img, cardX+cardW-48-260, cardY+80, 240, 240); finalize(); };
          img.src = dataUrl;
        }catch(e){ finalize(); }
        function finalize(){
          const url = canvas.toDataURL("image/png");
          const a = document.createElement("a"); a.href=url; a.download="åˆ˜è®°é£Ÿåºœ-é¢„è®¢é‚€è¯·-æµ·æŠ¥.png"; document.body.appendChild(a); a.click(); a.remove();
        }
      });
    })();
  </script>
</body>
</html>
